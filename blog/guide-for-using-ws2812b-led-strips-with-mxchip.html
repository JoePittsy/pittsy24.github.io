<!DOCTYPE html>
<html lang="en-gb">
<head>
  <script type="application/ld+json">
          {
            "@context": "http://schema.org",
            "@type": "TechArticle",
            "headline": "Automatic Display Rotation",
            "datePublished": "2020-06-28T20:18:22.883324"
            "image": "https://JoePittsy.co.uk/resources/JoePitts.jpg",
            "author": {
              "@type": "Person",
              "name": "Joe Pitts",
              "additionalName": "David",
              "affiliation": "University of Lincoln",
              "jobTitle": "Developer",
              "url": "https://JoePitts.co.uk",
              "sameAs": [
                "https://www.facebook.com/Joe.Pittsy",
                "https://www.linkedin.com/in/JoePittsy",
                "https://twitter.com/JoePittsy",
                "https://www.instagram.com/JoePittsy/",
                "https://github.com/Pittsy24"
              ],
              "image": "https://JoePittsy.co.uk/resources/JoePitts.jpg",
              "description": "Joe Pitts, Developer at the University of Lincoln"
            }
          }
      </script>

  <meta name="twitter:card" content="summary">
  </meta>
  <meta name="twitter:site" content="@JoePittsy">
  </meta>
  <meta name="twitter:description"
    content="Having the display rotate to match the orientation of our device is
    something we all take for granted on our phones and tablets, but for
    some reason, it never made it to our PCs..."
    name="description">
  <meta name="twitter:title" content="Joe Pitts | Automatic Display Rotation">
  <meta name="twitter:creator" content="@JoePittsy"> 
  <meta property="og:image" content="https://joepitts.co.uk/resources/JoePitts.jpg" />

  <meta property='og:title' content="Automatic Display Rotation"/>
  <meta property='og:description' content="Having the display rotate to match the orientation of our device is
    something we all take for granted on our phones and tablets, but for
    some reason, it never made it to our PCs..."/>
  <meta property='og:url' content="https://joepitts.co.uk/blog/monitor.html"/>
  <meta name="author" content="Joe Pitts"> 

  <meta name="twitter:image" content="https://joepitts.co.uk/resources/JoePitts.jpg">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114382787-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());
    gtag("config", "UA-114382787-2");
  </script>
  <script src="/js/darkMode.js" type="text/javascript"></script>
  <script src="/js/clipboard.min.js"></script>
  <link href="/resources/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
  <link href="/resources/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
  <link href="/resources/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
  <link href="/resources/site.webmanifest" rel="manifest">
  <link href="/resources/safari-pinned-tab.svg" rel="mask-icon">
  <meta content="#da532c" name="msapplication-TileColor">
  <meta content="#ffffff" name="theme-color">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <title>Joe Pitts | Automatic Display Rotation</title>
  <link href="/style.css" rel="stylesheet" type="text/css">
  <meta
    content="Website of Joe Pitts, a 20 year old Developer and Student of Computer Science at the University of Lincoln UK"
    name="description">
  <meta lang="en-gb">
</head>

<body link="black" style="height: auto;">
  <div class="content" id="content">
    <header>
      <div id="containter">
        <div id="header">
          <img alt="Joe Pitts" id="logo" src="/resources/JoePitts.jpg" title="Joe Pitts" width="10%"> <a href="/"
            id="title">
            <p>Joe Pitts</p>
          </a>
          <div class="burger" onclick="document.getElementById('drop').click();">
            <div></div>
            <div></div>
            <div></div>
          </div>
        </div>
      </div>
      <aside>
        <nav id="burger">
          <label class="toggle" for="drop" style="pointer-events: none;"></label> <input id="drop" type="checkbox">
          <ul class="menu" id="burger_menu">
            <li>
              <a href="/">Home</a>
            </li>
            <li>
              <a href="/blog">Blog</a>
            </li>
            <li>
              <a href="/work.html">My Work</a>
            </li>
            <li>
              <a href="https://www.linkedin.com/in/joepittsy/">Linkedin</a>
            </li>
            <li>
              <a href="/instagram.html">Photography</a>
            </li>
            <li>
              <a class="toggleDark" onclick="toggleNightMode();">Dark Mode</a>
            </li>
          </ul>
        </nav>
        <nav id="normalMenu">
          <ul class="menu">
            <li>
              <a href="/">Home</a>
            </li>
            <li>
              <a href="/blog">Blog</a>
            </li>
            <li>
              <a href="/work.html">My Work</a>
            </li>
            <li>
              <a href="https://www.linkedin.com/in/joepittsy/">Linkedin</a>
            </li>
            <li>
              <a href="/instagram.html">Photography</a>
            </li>
            <li>
              <a class="toggleDark" onclick="toggleNightMode();">Dark Mode</a>
            </li>
          </ul>
        </nav>
      </aside>
    </header>
    <hr />
    <div class="blogPost">
      <h2>Guide for using WS2812B LED Strips with MXChip</h2> <span id="readingTime">
        <date>28th of June 2020</date> | <p>6-7 minutes</p>
      </span>
      <h3>Introduction</h3>
      <p>
        Having the display rotate to match the orientation of our device is
        something we all take for granted on our phones and tablets, but for
        some reason, it never made it to our PCs even though a lot of content we
        consume is better suited for a vertical screen (Reddit, Writing,
        Programming, e.t.c).
      </p>
      <p>
        This blog post is going to be about how I implemented auto-rotating
        displays using Microsoft's MXChip IoT DevKit.
      </p>

      <h3>Determining the rotation of the MXChip</h3>
      <p>In order to rotate the display, we first need to know the rotation of the MXChip. To do this we will use the
        LSM6DSL Sensor, an accelerometer and gyroscope sensor on the MXChip. By rotating the MXChip in my hands and
        looking at a real-time readout of the accelerometer's X and Y values I was able to find bounds that told me the
        rotation of the chip.</p>
      <div class="codeSnippet">
        <div class="double-val-label">
          <span class="cpp">C++</span>
          <span data-clipboard-target="#getRot" id="rotCopy">Copy</span>
        </div>
        <pre><div id = "getRot" style="color: #383a42;/*! background-color: #fafafa; */font-family: 'Droid Sans Mono', 'monospace', monospace, 'Droid Sans Fallback';font-weight: normal;font-size: 14px;line-height: 19px;white-space: pre;"><div><span style="color: #a626a4;">int</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">getRotation</span><span style="color: #383a42;">()</span></div><div><span style="color: #383a42;">{</span></div><div><span style="color: #383a42;">    </span><span style="color: #e45649;">sensor</span><span style="color: #383a42;">-&gt;</span><span style="color: #4078f2;">enableAccelerator</span><span style="color: #383a42;">();</span></div><div><span style="color: #383a42;">    </span><span style="color: #e45649;">sensor</span><span style="color: #383a42;">-&gt;</span><span style="color: #4078f2;">getXAxes</span><span style="color: #383a42;">(axes);</span></div><br><div><span style="color: #a0a1a7;font-style: italic;">    // If the X axis is between -500 and 500 the device is vertical</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">if</span><span style="color: #383a42;"> (</span><span style="color: #e45649;">axes</span><span style="color: #383a42;">[</span><span style="color: #986801;">0</span><span style="color: #383a42;">] </span><span style="color: #a626a4;">&lt;=</span><span style="color: #383a42;"> </span><span style="color: #986801;">500</span><span style="color: #383a42;"> </span><span style="color: #a626a4;">&amp;&amp;</span><span style="color: #383a42;"> </span><span style="color: #e45649;">axes</span><span style="color: #383a42;">[</span><span style="color: #986801;">0</span><span style="color: #383a42;">] </span><span style="color: #a626a4;">&gt;=</span><span style="color: #383a42;"> </span><span style="color: #a626a4;">-</span><span style="color: #986801;">500</span><span style="color: #383a42;">){</span></div><div><span style="color: #a0a1a7;font-style: italic;">        // If the Y axis is &gt;= 0 then the device is pointed down</span></div><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">if</span><span style="color: #383a42;"> (</span><span style="color: #e45649;">axes</span><span style="color: #383a42;">[</span><span style="color: #986801;">1</span><span style="color: #383a42;">] </span><span style="color: #a626a4;">&gt;=</span><span style="color: #383a42;"> </span><span style="color: #986801;">0</span><span style="color: #383a42;">)</span></div><div><span style="color: #383a42;">            </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> D_DOWN;</span></div><div><span style="color: #a0a1a7;font-style: italic;">        // Else the device must be pointing upwards</span></div><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">else</span></div><div><span style="color: #383a42;">            </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> D_UP;</span></div><div><span style="color: #383a42;">    }</span></div><div><span style="color: #a0a1a7;font-style: italic;">    // If we're not vertical we must be horizontal</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">else</span><span style="color: #383a42;">{</span></div><div><span style="color: #a0a1a7;font-style: italic;">        // If the X axis is &gt;= 0 the device is on its right side</span></div><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">if</span><span style="color: #383a42;"> (</span><span style="color: #e45649;">axes</span><span style="color: #383a42;">[</span><span style="color: #986801;">0</span><span style="color: #383a42;">] </span><span style="color: #a626a4;">&gt;=</span><span style="color: #383a42;"> </span><span style="color: #986801;">0</span><span style="color: #383a42;">)</span></div><div><span style="color: #383a42;">            </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> D_RIGHT;</span></div><div><span style="color: #a0a1a7;font-style: italic;">        // Otherwise its on its left</span></div><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">else</span></div><div><span style="color: #383a42;">            </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> D_LEFT;</span></div><div><span style="color: #383a42;">    }</span></div><div><span style="color: #383a42;">}</span>       </div></div></pre>
      </div>
      <p>Now that we know the rotation of the MXChip we need to find a way to send this to the PC so it can rotate the
        display to match.</p>

      <h3>MXChip to PC Communication</h3>
      <p>
        The MXChip is primarily made for connecting to Azure Web Services,
        however, I decided not to go with Azure, or any cloud service, for this
        project. There were a few reasons for this:
      </p>
      <ol>
        <li>
          This project was made during the 2020 Global Covid-19 pandemic and
          cloud resources were prioritised for hospitals and other government
          uses.
        </li>
        <li>
          I felt that spinning up a database to store the rotation of my monitor
          might be a little overkill.
        </li>
      </ol>
      <p>
        My first thought was using a serial connection and this would have
        worked great apart from I'd have to run a USB cable to the back of the
        monitor with enough slack to allow it to rotate and well I don't own any
        USB cables that long. If your monitor has USB passthrough then this
        would be the way to go.
      </p>
      <p>
        Since a solution using serial was unfeasible I knew the MXChip to PC
        communication would have to be wireless. I decided to use MQTT, a
        publish-subscribe protocol. Using this I could publish all of the sensor
        data from the chip to the same server but on different topics, therefore
        allowing future projects to have easy access to the data.
      </p>
      <figure class="imageCaptionBox">
        <picture id="mqttImage">
          <source srcset="/resources/images/mqtt.webp" type="image/webp">
          <source srcset="/resources/images/mqtt.jpg" type="image/jpeg">
          <img src="/resources/images/mqtt.jpg">
        </picture>

        <figcaption>By using MQTT I can publish all the MXChip's sensor data and have easy access to it anywhere. This
          screenshot is from the <a
            href="https://play.google.com/store/apps/details?id=com.app.vetru.mqttdashboard&hl=en_GB">MQTT Dashboard app
            for android</a>.</figcaption>
      </figure>
      <h4>Implementation</h4>
      <p>To start with I downloaded and installed an MQTT broker, a server that receives messages from clients and sends
        them to any clients that are subscribed. I decided to use Eclipse Mosquitto a lightweight command-line broker.
      </p>
      <div class="codeSnippet">
        <div class="double-val-label">
          <span class="shell">Shell</span>
          <span data-clipboard-target="#getMos" id="mosCopy">Copy</span>
        </div>
        <pre
          id="getMos"><div style="color: #383a42;/*! background-color: #fafafa; */font-family: 'Droid Sans Mono', 'monospace', monospace, 'Droid Sans Fallback';font-weight: normal;/*! font-size: 14px; */line-height: 19px;white-space: pre;"><div><span style="color: #383a42;">$ sudo apt-get update</span></div><div><span style="color: #383a42;">$ sudo apt-get install mosquitto</span></div></div></pre>
      </div>
      <p>Once that was set up I wrote a C++ class for the MXChip to handle connecting to the broker, subscribing and
        receiving messages and sending data to topics. For the PC side I decided to use Python and <a
          href="https://pypi.org/project/paho-mqtt/">paho-mqtt</a> to subscribe to the topic where the rotation data was
        being published and then execute the command to rotate the monitor.</p>
      <div class="codeSnippet">
        <div class="double-val-label">
          <span class="python">Python</span>
          <span data-clipboard-target="#getPy" id="pyCopy">Copy</span>
        </div>
        <pre><div id="getPy" style="color: #383a42;/*! background-color: #fafafa; *//*! font-family: 'Droid Sans Mono', 'monospace', monospace, 'Droid Sans Fallback'; */font-weight: normal;/*! font-size: 14px; */line-height: 19px;white-space: pre;"><div><span style="color: #a626a4;">import</span><span style="color: #383a42;"> paho.mqtt.client </span><span style="color: #a626a4;">as</span><span style="color: #383a42;"> mqtt</span></div><div><span style="color: #a626a4;">import</span><span style="color: #383a42;"> os</span></div><br><div><span style="color: #a626a4;">def</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">on_connect</span><span style="color: #383a42;">(</span><span style="color: #986801;">client</span><span style="color: #383a42;">,</span><span style="color: #986801;"> userdata</span><span style="color: #383a42;">,</span><span style="color: #986801;"> flags</span><span style="color: #383a42;">,</span><span style="color: #986801;"> rc</span><span style="color: #383a42;">):</span></div><div><span style="color: #383a42;">    </span><span style="color: #0184bc;">print</span><span style="color: #383a42;">(</span><span style="color: #50a14f;">"Connected with result code "</span><span style="color: #383a42;">+</span><span style="color: #0184bc;">str</span><span style="color: #383a42;">(rc))</span></div><div><span style="color: #383a42;">    client.subscribe(</span><span style="color: #50a14f;">"monitor/#"</span><span style="color: #383a42;">)</span></div><br><div><span style="color: #a626a4;">def</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">on_message</span><span style="color: #383a42;">(</span><span style="color: #986801;">client</span><span style="color: #383a42;">,</span><span style="color: #986801;"> userdata</span><span style="color: #383a42;">,</span><span style="color: #986801;"> msg</span><span style="color: #383a42;">):</span></div><div><span style="color: #383a42;">    decoded_msg = </span><span style="color: #0184bc;">str</span><span style="color: #383a42;">(msg.payload, </span><span style="color: #50a14f;">"utf-8"</span><span style="color: #383a42;">)</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">if</span><span style="color: #383a42;"> (</span><span style="color: #50a14f;">"upright"</span><span style="color: #383a42;"> </span><span style="color: #a626a4;">in</span><span style="color: #383a42;"> decoded_msg):</span></div><div><span style="color: #383a42;">        os.system(</span><span style="color: #50a14f;">"xrandr --output eDP --rotate normal"</span><span style="color: #383a42;">)</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">elif</span><span style="color: #383a42;">(</span><span style="color: #50a14f;">"left"</span><span style="color: #383a42;"> </span><span style="color: #a626a4;">in</span><span style="color: #383a42;"> decoded_msg):</span></div><div><span style="color: #383a42;">        os.system(</span><span style="color: #50a14f;">"xrandr --output eDP --rotate left"</span><span style="color: #383a42;">)</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">elif</span><span style="color: #383a42;">(</span><span style="color: #50a14f;">"right"</span><span style="color: #383a42;"> </span><span style="color: #a626a4;">in</span><span style="color: #383a42;"> decoded_msg):</span></div><div><span style="color: #383a42;">        os.system(</span><span style="color: #50a14f;">"xrandr --output eDP --rotate right"</span><span style="color: #383a42;">)</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">elif</span><span style="color: #383a42;">(</span><span style="color: #50a14f;">"upside down"</span><span style="color: #383a42;"> </span><span style="color: #a626a4;">in</span><span style="color: #383a42;"> decoded_msg):</span></div><div><span style="color: #383a42;">        os.system(</span><span style="color: #50a14f;">"xrandr --output eDP --rotate inverted"</span><span style="color: #383a42;">)</span></div><br><div><span style="color: #383a42;">client = mqtt.Client()</span></div><div><span style="color: #383a42;">client.on_connect = on_connect</span></div><div><span style="color: #383a42;">client.on_message = on_message</span></div><div><span style="color: #383a42;">client.connect(</span><span style="color: #50a14f;">"192.168.0.12"</span><span style="color: #383a42;">, </span><span style="color: #986801;">1883</span><span style="color: #383a42;">, </span><span style="color: #986801;">60</span><span style="color: #383a42;">)</span></div><div><span style="color: #383a42;">client.loop_forever()</span></div></div></pre>
      </div>
      <p>I set this script to run at startup and it worked great, the prototype was complete!</p>
      <video autoplay controls muted loop width="320">
        <source src="/resources/videos/demo.mp4" type="video/mp4">
        <source src="/resources/videos/demo.webm" type="video/webm">
      </video>
      <h3>Thoughts and future development</h3>
      <p>This project was definitely a success and is something Ive found myself using almost daily without even
        thinking about it, that's not to say there isn't improvements I want to make. For one this only works on Linux
        at the moment, a Windows version would definitely be welcome. Another issue i've ran into is the MXChip losing
        connection to the Wi-FI, I believe this is an issue of the Wi-Fi signal being rather weak behind my monitor, a
        way to help mitigate this issue would be setting up a MQTT <a
          href="https://www.hivemq.com/blog/mqtt-essentials-part-9-last-will-and-testament/">last will and testament</a>
        for when the MXChip loses connection, I could then have my phone send me a notification telling me to reset the
        MXChip. Overall I am very happy with this project and if you have an MXChip or Arduino with an accelerometer
        handy I would recommend building this project yourself!</p>
    </div>
    <div id="disqus_thread"></div>
<script>
(function() { // DON'T EDIT BELOW THIS LINEx
var d = document, s = d.createElement('script');
s.src = 'https://joepitts-co-uk.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>

  <div class="footer">
    <p align="center"><a href="https://linkedin.com/in/JoePittsy">LinkedIn</a>&nbsp;&nbsp; <a
        href="https://twitter.com/JoePittsy">Twitter</a>&nbsp;&nbsp;<a
        href="https://instagram.com/JoePittsy">Instagram</a>&nbsp;&nbsp;<a href="https://github.com/Pittsy24">GitHub</a>
    </p>
    <p id="copyright">Copyright © 2018-2020 Joe Pitts</p>
  </div>
  <script defer>
    (function () {
      new ClipboardJS('#rotCopy, #mosCopy, #pyCopy');
    })();
  </script>
</body>

</html>
