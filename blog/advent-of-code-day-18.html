<!DOCTYPE html>
<html lang="en-gb">

<head>
<script data-ad-client="ca-pub-1254309748341319" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script type="application/ld+json">
      {
        "@context": "http://schema.org",
        "@type": "TechArticle",
        "headline": "Advent of Code Day 18: Operation Order",
        "datePublished": "2020-12-18",
        "author": {
          "@type": "Person",
          "name": "Joe Pitts",
          "additionalName": "David",
          "affiliation": "University of Lincoln",
          "jobTitle": "Developer",
          "url": "https://JoePitts.co.uk",
          "sameAs": [
            "https://www.facebook.com/Joe.Pittsy",
            "https://www.linkedin.com/in/JoePittsy",
            "https://twitter.com/JoePittsy",
            "https://www.instagram.com/JoePittsy/",
            "https://github.com/JoePittsy"
          ]
        },
        "description": "Day Eighteen of Advent of Code 2020!",
        "image": "https://joepitts.co.uk/resources/images/xmas/18.jpg"
   
      }
    </script>

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@JoePittsy" />
    <meta name="twitter:description" content="Operation Order | Advent of Code 2020!" name="description" />
    <meta name="twitter:title" content="Joe Pitts | Advent of Code Day 18" />
    <meta name="twitter:creator" content="@JoePittsy" />
    <meta property="og:image" content="https://joepitts.co.uk/resources/images/xmas/18.jpg" />

    <meta property="og:title" content="Advent of Code Day 18" />
    <meta property="og:description" content="Day Eighteen of Advent of Code 2020!" />
    <meta property="og:url" content="https://joepitts.co.uk/blog/advent-of-code-day-18.html" />
    <meta name="author" content="Joe Pitts" />

    <meta name="twitter:image" content="https://joepitts.co.uk/resources/images/xmas/18.jpg" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114382787-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
            dataLayer.push(arguments);
        }
        gtag("js", new Date());
        gtag("config", "UA-114382787-2");
    </script>
    <script src="/js/darkMode.js" type="text/javascript"></script>
    <script src="/js/clipboard.min.js"></script>
    <link href="/resources/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" />
    <link href="/resources/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" />
    <link href="/resources/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" />
    <link href="/resources/site.webmanifest" rel="manifest" />
    <link href="/resources/safari-pinned-tab.svg" rel="mask-icon" />
    <meta content="#da532c" name="msapplication-TileColor" />
    <meta content="#ffffff" name="theme-color" />
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Joe Pitts | Advent of Code Day 18</title>
    <link href="/style.css" rel="stylesheet" type="text/css" />
    <meta content="Advent of Code Day 18!" name="description" />
    <meta lang="en-gb" />
    <noscript>
        <style>
            .jsonly {
                display: none;
            }
        </style>
    </noscript>
</head>

<body link="black" style="height: auto;">
    <div class="content" id="content">
            <header>
      <div id="container">
        <div id="header">
          <img alt="Joe Pitts" id="logo" src="/resources/JoePitts.jpg" title="Joe Pitts" width="10%" />
          <!-- <a href="/" id="title">
                    <p>Joe Pitts</p>
                  </a> -->
          <nav id="normalMenu">
            <ul class="menu">
              <li>
                <a href="/">Home</a>
              </li>
              <li>
                <a href="/blog" id="currentPage">Blog</a>
              </li>
              <li>
                <a href="/work.html">My Work</a>
              </li>
              <li>
                <a href="/games/">Games</a>
              </li>
              <li id="darkItem">
                <img class="toggleDark" onclick="toggleNightMode()" src="../resources/moon.svg">
                <!-- <a class="toggleDark" onclick="toggleNightMode();">Dark Mode</a> -->
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </header>
        <hr />
        <div class="blogPost">
            <h1>Advent of Code: Day #18 - Operation Order</h1>
            <span id="readingTime">
                <date>18th of December 2020</date> |
                <p>5 - 6 minutes</p>
            </span>
            <a class="anchor" href="#introduction">
                <h2 id="introduction">Introduction</h2>
            </a>
            <p>
                My solution feels very kludged together today but it works, and my part two is quite nice!
            </p>

            <a class="anchor" href="#one">
                <h2 id="one">Task One</h2>
            </a>
            <p>
                Given an equation evaluate it from left to right with no order of operations, parentheses are still
                evaluated first however.

            </p>
            <h3>Reading in the data</h3>
            <p>
                The equations where just read into an array.
            </p>

            <div class="codeSnippet">
                <div class="double-val-label">
                    <span class="python">Python</span>
                    <span data-clipboard-target="#getDataIn" id="dataCopy">Copy</span>
                </div>
            <pre><div id="getDataIn" spellcheck="false" style="color: #383a42; font-family: 'Fira Code', 'Droid Sans Mono', 'monospace', monospace, 'Droid Sans Fallback';font-weight: normal;font-size: 15px;line-height: 19px;white-space: pre;" contenteditable="false"><div><div><span style="color: #a626a4;">def</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">read_data</span><span style="color: #383a42;">(</span><span style="color: #986801;">path</span><span style="color: #383a42;">):</span></div><div><span style="color: #383a42;">    dataset = []</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">with</span><span style="color: #383a42;"> </span><span style="color: #0184bc;">open</span><span style="color: #383a42;">(path) </span><span style="color: #a626a4;">as</span><span style="color: #383a42;"> f:</span></div><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">for</span><span style="color: #383a42;"> line </span><span style="color: #a626a4;">in</span><span style="color: #383a42;"> f.readlines():</span></div><div><span style="color: #383a42;">            dataset.append(line.strip())</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> dataset</span></div></div></div></pre>
            </div>

            <h3>The Solution</h3>
            <p>
                To start with I decided to split the question into a list, <tt>"1+(2*3)+(4*(5+6))"</tt> became
                <tt>['1','+',['2','*','3'],'+',['4','*',['5','+','6']]]</tt>. I then loop through the items in these
                lists and create a new expression with the brackets evaluated, I do this by calling the same function on
                the sub brackets. The sum before would become 1 + 6 + (4 * 11) and then 7 + 44 and finally returned as
                51.
            </p>
            <div class="codeSnippet">
                <div class="double-val-label">
                    <span class="python">Python</span>
                    <span data-clipboard-target="#getTaskOne" id="oneCopy">Copy</span>
                </div>
                <pre id="getTaskOne"
                    spellcheck="false"><div style="color: #383a42;font-family: 'Fira Code', 'Droid Sans Mono', 'monospace', monospace, 'Droid Sans Fallback';font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre;" spellcheck="false" contenteditable="false"><div><div><span style="color: #a626a4;">def</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">task_one</span><span style="color: #383a42;">(</span><span style="color: #986801;">data</span><span style="color: #383a42;">):</span></div><div><span style="color: #383a42;">    </span><span style="color: #a0a1a7;font-style: italic;"># Match numbers, the Plus and Times symbol and a whitespace</span></div><div><span style="color: #383a42;">    matcher = pyparsing.Word(pyparsing.alphanums) | </span><span style="color: #50a14f;">'+'</span><span style="color: #383a42;"> | </span><span style="color: #50a14f;">'*'</span><span style="color: #383a42;"> | </span><span style="color: #50a14f;">" "</span></div><div><span style="color: #383a42;">    </span><span style="color: #a0a1a7;font-style: italic;"># Match them between nested parentheses</span></div><div><span style="color: #383a42;">    parens = pyparsing.nestedExpr(</span><span style="color: #50a14f;">'('</span><span style="color: #383a42;">, </span><span style="color: #50a14f;">')'</span><span style="color: #383a42;">, </span><span style="color: #986801;">content</span><span style="color: #383a42;">=matcher)</span></div><br><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">def</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">try_int</span><span style="color: #383a42;">(</span><span style="color: #986801;">s</span><span style="color: #383a42;">):</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">try</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> </span><span style="color: #0184bc;">int</span><span style="color: #383a42;">(s)</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">except</span><span style="color: #383a42;"> </span><span style="color: #0184bc;">ValueError</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> s</span></div><br><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">def</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">solve</span><span style="color: #383a42;">(</span><span style="color: #986801;">string_equation</span><span style="color: #383a42;">):</span></div><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">def</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">_eval</span><span style="color: #383a42;">(</span><span style="color: #986801;">s</span><span style="color: #383a42;">):</span></div><div><span style="color: #383a42;">            </span><span style="color: #50a14f;">"""</span></div><div><span style="color: #50a14f;">            Evaluates an expression left to right</span></div><div><span style="color: #50a14f;">            :param s: String expresion</span></div><div><span style="color: #50a14f;">            :return: The answer</span></div><div><span style="color: #50a14f;">            """</span></div><br><div><span style="color: #383a42;">            total = </span><span style="color: #986801;">0</span></div><div><span style="color: #383a42;">            operator = </span><span style="color: #986801;">None</span></div><div><span style="color: #383a42;">            list_expr = [i.strip() </span><span style="color: #a626a4;">for</span><span style="color: #383a42;"> i </span><span style="color: #a626a4;">in</span><span style="color: #383a42;"> re.split(</span><span style="color: #a626a4;">r</span><span style="color: #0184bc;">"(</span><span style="color: #383a42;">[</span><span style="color: #0184bc;">\w</span><span style="color: #986801;">'</span><span style="color: #383a42;">]+</span><span style="color: #0184bc;">)"</span><span style="color: #383a42;">, s)[</span><span style="color: #986801;">1</span><span style="color: #383a42;">:-</span><span style="color: #986801;">1</span><span style="color: #383a42;">]]</span></div><br><div><span style="color: #383a42;">            </span><span style="color: #a626a4;">for</span><span style="color: #383a42;"> i </span><span style="color: #a626a4;">in</span><span style="color: #383a42;"> list_expr:</span></div><div><span style="color: #383a42;">                item = try_int(i)</span></div><div><span style="color: #383a42;">                </span><span style="color: #a626a4;">if</span><span style="color: #383a42;"> </span><span style="color: #0184bc;">type</span><span style="color: #383a42;">(item) </span><span style="color: #a626a4;">is</span><span style="color: #383a42;"> </span><span style="color: #0184bc;">int</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">                    </span><span style="color: #a626a4;">if</span><span style="color: #383a42;"> operator == </span><span style="color: #50a14f;">"*"</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">                        total *= item</span></div><div><span style="color: #383a42;">                    </span><span style="color: #a626a4;">elif</span><span style="color: #383a42;"> operator == </span><span style="color: #50a14f;">"+"</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">                        total += item</span></div><div><span style="color: #383a42;">                    </span><span style="color: #a626a4;">elif</span><span style="color: #383a42;"> operator </span><span style="color: #a626a4;">is</span><span style="color: #383a42;"> </span><span style="color: #986801;">None</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">                        total = item</span></div><div><span style="color: #383a42;">                </span><span style="color: #a626a4;">else</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">                    operator = item</span></div><div><span style="color: #383a42;">            </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> total</span></div><br><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">def</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">_solve</span><span style="color: #383a42;">(</span><span style="color: #986801;">list_equation</span><span style="color: #383a42;">,</span><span style="color: #986801;"> depth</span><span style="color: #383a42;">=</span><span style="color: #986801;">0</span><span style="color: #383a42;">):</span></div><br><div><span style="color: #383a42;">            memory = []</span></div><div><span style="color: #383a42;">            simplified_equation = </span><span style="color: #50a14f;">""</span></div><br><div><span style="color: #383a42;">            </span><span style="color: #a626a4;">for</span><span style="color: #383a42;"> index, item </span><span style="color: #a626a4;">in</span><span style="color: #383a42;"> </span><span style="color: #0184bc;">enumerate</span><span style="color: #383a42;">(list_equation):</span></div><div><span style="color: #383a42;">                </span><span style="color: #a626a4;">if</span><span style="color: #383a42;"> </span><span style="color: #0184bc;">type</span><span style="color: #383a42;">(item) != </span><span style="color: #0184bc;">list</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">                    memory.append(item)</span></div><div><span style="color: #383a42;">                </span><span style="color: #a626a4;">else</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">                    </span><span style="color: #a0a1a7;font-style: italic;"># Got to a bracket</span></div><div><span style="color: #383a42;">                    </span><span style="color: #a626a4;">if</span><span style="color: #383a42;"> </span><span style="color: #0184bc;">len</span><span style="color: #383a42;">(memory) &gt;= </span><span style="color: #986801;">1</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">                        memory.pop()</span></div><div><span style="color: #383a42;">                        simplified_equation += </span><span style="color: #50a14f;">""</span><span style="color: #383a42;">.join(memory)</span></div><div><span style="color: #383a42;">                        memory = []</span></div><div><span style="color: #383a42;">                        new_eq_tmp = </span><span style="color: #a626a4;">f</span><span style="color: #50a14f;">" </span><span style="color: #986801;">{</span><span style="color: #383a42;">list_equation[index - </span><span style="color: #986801;">1</span><span style="color: #383a42;">]</span><span style="color: #986801;">}</span><span style="color: #50a14f;"> </span><span style="color: #986801;">{</span><span style="color: #383a42;">_solve(item, depth + </span><span style="color: #986801;">1</span><span style="color: #383a42;">)</span><span style="color: #986801;">}</span><span style="color: #50a14f;">"</span></div><div><span style="color: #383a42;">                        simplified_equation += new_eq_tmp</span></div><div><span style="color: #383a42;">                    </span><span style="color: #a626a4;">else</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">                        new_eq_tmp = </span><span style="color: #a626a4;">f</span><span style="color: #50a14f;">" + </span><span style="color: #986801;">{</span><span style="color: #383a42;">_solve(item, depth + </span><span style="color: #986801;">1</span><span style="color: #383a42;">)</span><span style="color: #986801;">}</span><span style="color: #50a14f;">"</span></div><div><span style="color: #383a42;">                        simplified_equation += new_eq_tmp</span></div><br><div><span style="color: #383a42;">            simplified_equation = </span><span style="color: #a626a4;">f</span><span style="color: #50a14f;">"</span><span style="color: #986801;">{</span><span style="color: #383a42;">simplified_equation</span><span style="color: #986801;">}</span><span style="color: #50a14f;"> </span><span style="color: #986801;">{</span><span style="color: #50a14f;">''</span><span style="color: #383a42;">.join(memory)</span><span style="color: #986801;">}</span><span style="color: #50a14f;">"</span></div><div><span style="color: #383a42;">            </span><span style="color: #a626a4;">if</span><span style="color: #383a42;"> index &gt;= </span><span style="color: #0184bc;">len</span><span style="color: #383a42;">(list_equation) - </span><span style="color: #986801;">1</span><span style="color: #383a42;">:</span></div><div><span style="color: #383a42;">                </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> _eval(simplified_equation)</span></div><div><span style="color: #383a42;">            </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> simplified_equation</span></div><br><div><span style="color: #383a42;">        groups = parens.parseString(</span><span style="color: #50a14f;">"("</span><span style="color: #383a42;"> + string_equation + </span><span style="color: #50a14f;">")"</span><span style="color: #383a42;">).asList()[</span><span style="color: #986801;">0</span><span style="color: #383a42;">]</span></div><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> _solve(groups)</span></div><br><div><span style="color: #383a42;">    ans = </span><span style="color: #0184bc;">sum</span><span style="color: #383a42;">([solve(question) </span><span style="color: #a626a4;">for</span><span style="color: #383a42;"> question </span><span style="color: #a626a4;">in</span><span style="color: #383a42;"> data])</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> ans</span></div></div></div></pre>
                </div>

            <a class="anchor" href="#two">
                <h2 id="two">Task Two</h2>
            </a>
            <h3>The Solution</h3>
            <p>
                For Task Two we are told to implement an order of operations where addition comes before multiplication.
                To implement this I used a trick from the old <a
                    href="https://en.wikipedia.org/wiki/Operator-precedence_parser#Alternative_methods">FORTRAN
                    complier</a> and wrapped the questions in a load of brackets and then just used the left to right
                solver we made in part one.
            </p>
            <div class="codeSnippet">
                <div class="double-val-label">
                    <span class="python">Python</span>
                    <span data-clipboard-target="#getTaskTwo" id="twoCopy">Copy</span>
                </div>
                <pre spellcheck="false"
                    id="getTaskTwo"><div style="color: #383a42;font-family: 'Fira Code', 'Droid Sans Mono', 'monospace', monospace, 'Droid Sans Fallback';font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre; " spellcheck="false" contenteditable="false"><div><div><span style="color: #a626a4;">def</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">task_two</span><span style="color: #383a42;">(</span><span style="color: #986801;">data</span><span style="color: #383a42;">):</span></div><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">def</span><span style="color: #383a42;"> </span><span style="color: #4078f2;">parenthesise</span><span style="color: #383a42;">(</span><span style="color: #986801;">s</span><span style="color: #383a42;">):</span></div><div><span style="color: #383a42;">        </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> </span><span style="color: #50a14f;">"(("</span><span style="color: #383a42;"> + s.replace(</span><span style="color: #50a14f;">"("</span><span style="color: #383a42;">, </span><span style="color: #50a14f;">"((("</span><span style="color: #383a42;">).replace(</span><span style="color: #50a14f;">")"</span><span style="color: #383a42;">, </span><span style="color: #50a14f;">")))"</span><span style="color: #383a42;">).replace(</span><span style="color: #50a14f;">"*"</span><span style="color: #383a42;">, </span><span style="color: #50a14f;">"))*(("</span><span style="color: #383a42;">).replace(</span><span style="color: #50a14f;">"+"</span><span style="color: #383a42;">, </span><span style="color: #50a14f;">")+("</span><span style="color: #383a42;">) + </span><span style="color: #50a14f;">"))"</span></div><br><div><span style="color: #383a42;">    </span><span style="color: #a626a4;">return</span><span style="color: #383a42;"> task_one([parenthesise(s) </span><span style="color: #a626a4;">for</span><span style="color: #383a42;"> s </span><span style="color: #a626a4;">in</span><span style="color: #383a42;"> data])</span></div></div></div></pre>
                </div>

            <a class="anchor" href="#links">
                <h2 id="links">Links</h2>
            </a>
            <div class="download">
                <p><a href="https://adventofcode.com/2020/leaderboard/private">Leaderboard Code:</a>
                    <small>353270-1fc6ef28</small>
                </p>
            </div>

            <div class="download">
                <p><a href="https://www.github.com/JoePittsy/AdventOfCode/">Github Repository</a>
                    <small>A link to the github repo containing all the days.</small>
                </p>
            </div>
            <div class="download">
                <p><a href="https://raw.githubusercontent.com/JoePittsy/AdventOfCode/main/Day 18/main.py"
                        download>main.py</a>
                    <small>A direct download of the main.py script</small>
                </p>
                <p class="download__instructions">
                    <small class="download__properties">2.9<abbr title="Kilobytes">Kb</abbr></small>
                </p>
            </div>


        </div>
        <p></p>
        <div id="disqus_thread"></div>
        <script>
            (function () {
                // DON'T EDIT BELOW THIS LINEx
                var d = document,
                    s = d.createElement("script");
                s.src = "https://joepitts-co-uk.disqus.com/embed.js";
                s.setAttribute("data-timestamp", +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the
            <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

<div class="footer">
    <ul class="footerContainer">
      <li>
        <p id="copyright">Copyright © 2018-2021, Joe Pitts. All rights reserved.</p>
      </li>
      <a href="https://www.linkedin.com/in/joepittsy"><img class="footerLogo" src="../resources/ln.svg"></a>
      <a href="https://github.com/JoePittsy">
        <li><img class="footerLogo" src="../resources/github.svg"></li>
      </a>
      <a href="https://twitter.com/JoePittsy">
        <li><img class="footerLogo" src="../resources/twitter.svg"></li>
      </a>
    </ul>

    <div class="mobileFooterContainer">
      <p id="copyright">Copyright © 2018-2021, Joe Pitts. All rights reserved.</p>
      <div class="mobileFooter">
        <a href="https://www.linkedin.com/in/joepittsy"><img class="footerLogo" src="../resources/ln.svg"></a>
        <a href="https://github.com/JoePittsy"><img class="footerLogo" src="../resources/github.svg"></a>
        <a href="https://twitter.com/JoePittsy"><img class="footerLogo" src="../resources/twitter.svg"></a>
      </div>
    </div>
    <script defer>
        (function () {
            new ClipboardJS("#dataCopy, #oneCopy, #twoCopy, #compCopy");
        })();
    </script>
</body>

</html>